"use strict";define("wixCodeInit/utils/urlBuilder",["experiment"],function(e){function i(){for(var e=arguments[0],i=1;i<arguments.length;++i)e=e.replace(/\/$/,"")+"/"+arguments[i].replace(/^\//,"");return e}function t(e){return/^https?:\/\/localhost\/?$/.test(e)}function n(e){return/^https?:\/\/s3.amazonaws.com\/integration-tests-statics\/(.+)\/SNAPSHOT\/santa?$/.test(e)}function r(e){return/^\d+\.\d+\.\d+$/.test(e)}function a(e,i){var t=e.lastIndexOf("/");return r(i)?e.substring(0,t+1)+i:e}function o(e,i){var r=e.serviceTopology,o=t(e.santaBase)||n(e.santaBase)?r.scriptsLocationMap.santa:e.santaBase;return o=a(o,i),/(.*\/services\/)?(.*)/.exec(o)[2]}function s(t,n,r,a){var s;s=e.isOpen("sv_splitRouterUrls")?a?"//"+n.instanceId+".pub.":"//"+n.instanceId+".dev.":"//"+n.instanceId+".";var d=t.serviceTopology.wixCloudBaseDomain,p="node_modules/santa-wix-code/"+(r.useWixCodeFallback?"fallback.html":"index.html");return s+i(d,"_partials",o(t,r.runtimeSource),p)}function d(e){return Object.keys(e).map(function(i){return encodeURIComponent(i)+"="+encodeURIComponent(e[i])}).join("&")}function p(e,i,t){t=t||{};var n=!!e.publicModel,r=s(e,i,t,n),a={compId:"wixCode_"+i.appDefinitionId,deviceType:t.isMobileView?"mobile":"desktop",viewMode:n?"site":e.renderFlags.componentViewMode||"preview",locale:e.rendererModel.languageCode,wixCodeBase:e.santaBase+"/node_modules/santa-wix-code","wix-code-platform":e.serviceTopology.scriptsLocationMap["wix-code-platform"]};return t.sdkSource&&(a.sdkSource=t.sdkSource),t.semiNativeSDKSource&&(a.semiNativeSDKSource=t.semiNativeSDKSource),t.applications&&(a.applications=JSON.stringify(t.applications)),t.ReactSource&&(a.ReactSource=t.ReactSource),r+"?"+d(a)}function c(e,i){i=i||{};var t=e.santaBase+"/node_modules/santa-wix-code/"+(i.useWixCodeFallback?"fallback.html":"index.html"),n=!!e.publicModel,r={deviceType:i.isMobileView?"mobile":"desktop",viewMode:n?"site":e.renderFlags.componentViewMode||"preview",locale:e.rendererModel.languageCode};return i.sdkSource&&(r.sdkSource=i.sdkSource),i.semiNativeSDKSource&&(r.semiNativeSDKSource=i.semiNativeSDKSource),i.applications&&(r.applications=JSON.stringify(i.applications)),i.ReactSource&&(r.ReactSource=i.ReactSource),t+"?"+d(r)}return{buildUrl:p,buildStaticUrl:c}}),define("wixCodeInit/utils/messageHolder",[],function(){function e(){var e=[],i=null;return{sendOrHoldMessage:function(t){i?i(t):e.push(t)},setMessageTarget:function(t){for(i=t;e.length>0;)i(e.shift())}}}return{get:e}}),define("wixCodeInit/utils/iFrameUtils",["lodash"],function(e){function i(i,t){var n=window.document.createElement("iframe");return n.style.cssText="position: fixed; left: 0; right: 0; top: 0; bottom: 0; width: 100%; height: 100%; background: transparent; border: 0",n.tabIndex=-1,n.setAttribute("aria-hidden","true"),n.src=i,e.get(t,"applicationId")&&e.get(t,"appDefinitionId")&&(n.setAttribute("data-app-id",t.applicationId),n.setAttribute("data-app-definition-id",t.appDefinitionId)),n}function t(e,i){return i.source===e.contentWindow}return{getIFrameForApp:i,isIFrameEvent:t}}),define("wixCodeInit/utils/constants",[],function(){return{APPS:{SANTA_MEMBERS:{appDefId:"14cc59bc-f0b7-15b8-e1c7-89ce41d0e0c9"},FORM_BUILDER:{appDefId:"14ce1214-b278-a7e4-1373-00cebd1bef7c"}}}}),define("wixCodeInit/utils/appsUtils",["lodash","wixCodeInit/utils/constants"],function(e,i){function t(i,t){return e(t).map(function(e){return i.getDynamicPageData(e)}).find()}function n(i,n,r){if(i){var a=t(i,r);if(a){var o=a.routerData,s=a.routerDefinition;if(o&&s)if("wix-code"===s.appDefinitionId)e.forEach(r,function(i){e.forEach(n,function(e){e.id===i&&(e.routerData=o)})});else{var d=e.find(n,{id:s.appDefinitionId});d&&(d.routerData=o)}}}}function r(i){var t={displayName:"siteextension"};return e(i).reject(t).map(function(i){return e.assign({type:S.APPLICATION},i)}).value()}function a(i){return!!e.get(i,["wixCodeModel","appData","codeAppId"])}function o(i){return e.some(i.widgets,"semiNative")}function s(i,t,n,r,o){if(a(r.rendererModel)&&e.find(i,t)){var s=r.isPlatformAppOnPage("masterPage","wixCode");e.forEach(n,function(i){var t=r.isPlatformAppOnPage(i,"wixCode"),n=r.getDataByQuery(i),a=e.get(n,"isPopup");t&&o.push({id:i,type:a?S.POPUP:S.PAGE,displayName:r.getPageTitle(i)}),!a&&s&&o.push({id:i,type:S.MASTER_PAGE})})}}function d(i,t,a){i=e.without(i,"masterPage");var o={displayName:"siteextension"},d=r(a);return s(a,o,i,t,d),n(t,d,i),d}function p(){for(var e=arguments[0],i=1;i<arguments.length;++i)e=e.replace(/\/$/,"")+"/"+arguments[i].replace(/^\//,"");return e}function c(e,i,t){var n=p(e.scriptsDomainUrl,"services",i);return t?p(n,t):e.scriptsLocationMap[i]}function u(i,t,n){if(e.get(i,"port")&&e.get(i,"path")&&e.get(i,"id")){n=e.endsWith(n,"/")?n.slice(0,-1):n;var r,a=e.template("<%= santaBase %><%= port %>/<%= path %>");r=/^(http(s)?:)?\/\//.test(i.path)?i.path:a("80"===i.port?{santaBase:n,port:"",path:i.path}:{santaBase:n,port:":"+i.port,path:i.path}),t.push({type:S.APPLICATION,id:i.id,url:r,displayName:i.id})}}function l(i,t,n,r,o){a(o)&&e.find(i,{type:"siteextension"})&&!e.find(t,{id:"dataBinding"})&&t.push({type:S.APPLICATION,id:"dataBinding",url:p(c(n,"dbsm-viewer-app",r.dataBinding),"/app.js"),hasSemiNativeWidgets:!1,displayName:"Data Binding"})}function f(t,n){return e.reduce(t,function(e,t){switch(t.appDefinitionId){case i.APPS.SANTA_MEMBERS.appDefId:e.push({id:t.appDefinitionId,displayName:t.type,appInnerId:t.applicationId,url:n.scriptsLocationMap["santa-members-viewer-app"]+"/app.js",hasSemiNativeWidgets:o(t)});break;case i.APPS.FORM_BUILDER.appDefId:e.push({id:t.appDefinitionId,displayName:t.type,appInnerId:t.applicationId,url:n.scriptsLocationMap["wix-form-builder"]+"/viewer-app.bundle.min.js"})}return e},[])}function g(i,t){return e(i).filter(function(i){return a(t)&&"siteextension"===i.type||e.has(i,"platformApp.viewerUrl")}).map(function(i){var t={id:i.appDefinitionId,displayName:i.type,appInnerId:i.applicationId},n=e.get(i,"platformApp.viewerUrl");return n&&(t.url=n),t.hasSemiNativeWidgets=o(i),t}).value()}function m(e){var i=g(e.clientSpecMap,e.rendererModel);i=i.concat(f(e.clientSpecMap,e.serviceTopology));var t=M(e.viewerPlatformAppSources);return u(t,i,e.santaBase),l(e.clientSpecMap,i,e.serviceTopology,t,e.rendererModel),i}function w(i){var t=m(i);return e.filter(r(t),"url")}function v(i,t,n){return d(t,n,m({clientSpecMap:i,viewerPlatformAppSources:e.get(n,["currentUrl","query","viewerPlatformAppSources"]),serviceTopology:n.serviceTopology,santaBase:n.santaBase,rendererModel:n.rendererModel}))}function M(i){return e(i||"").split(",").invokeMap("split",/:(.+)/).fromPairs().value()}function I(i,t,n){return e.reject(v(i,t,n),{type:S.APPLICATION})}var S={POPUP:"Popup",PAGE:"Page",MASTER_PAGE:"masterPage",APPLICATION:"Application"};return{getApplications:v,getUserCodeDefinitions:I,getAppsBaseInfo:w}}),define("wixCodeInit/utils/widgetsPreLoader",["wixCodeInit/utils/appsUtils"],function(e){function i(e,i,t,n){if(o())return c.push([e,i,t,n]),void requirejs(["utils","widgets","wixCode"],a);var r=n(s);r.currentUrl=s.urlUtils.parseUrl(e);var u=s.wixUrlParser.parseUrl(r,e),l=u&&u.pageId;if(l){var f=i(d,r,l),g=p.wixCodeWidgetService.getWixCodeSpec(r.getClientSpecMap());t(p.messageBuilder.getExtendedMessage(f,r.rendererModel.wixCodeModel||{},g,r))}}function t(t,n,r){i(n,function(i,n,r){var a=e.getApplications(t.rendererModel.clientSpecMap,[r],n),o=t.routers||{configMap:{}};return i.messageBuilder.loadWidgetsMessage(a,o.configMap,[r])},r,function(e){return new e.FullSiteData(t,function(){})})}function n(t,n,r){i(n,function(i,n,r){var a=e.getUserCodeDefinitions(t.rendererModel.clientSpecMap,[r],n);return i.messageBuilder.loadUserCodesMessage(a,[r])},r,function(e){return new e.FullSiteData(t,function(){})})}function r(e,t,n){i(t,function(e,i,t){var n={};return n[t]=e.widgetService.getContextInitData(i,t),e.messageBuilder.initWidgetsMessage(n)},n,function(){return e})}function a(e,t,n){if(o()){s=e,d=t,p=n;for(var r=0;r<c.length;r++)i.apply(null,c[r]);c.length=0}}function o(){return!s||!d||!p}var s=null,d=null,p=null,c=[];return{asyncGetPreLoadMessage:t,asyncGetPreLoadUserCodeMessage:n,asyncGetPreInitMessage:r,registerDeps:a}}),define("wixCodeInit/utils/specMapUtils",[],function(){function e(e){for(var t in e)if(e.hasOwnProperty(t)&&e[t].type===i)return e[t]}var i="siteextension";return{getAppSpec:e}}),define("wixCodeInit/api/wixCodeAppApi",["lodash","wixCodeInit/utils/urlBuilder","wixCodeInit/utils/messageHolder","wixCodeInit/utils/iFrameUtils","wixCodeInit/utils/widgetsPreLoader","wixCodeInit/utils/specMapUtils","wixCodeInit/utils/appsUtils"],function(e,i,t,n,r,a,o){function s(e){return"WIX_CODE"===e.intent&&"wix_code_iframe_loaded"===e.type}function d(e){return"WIX_CODE_SITE_API"===e.intent&&"reportBI"===e.type}function p(e){function i(){var i=window.document.body;i.insertBefore(e,i.firstChild)}"loading"!==window.document.readyState?i():window.document.addEventListener("DOMContentLoaded",function(){i()})}function c(i){var t=i.rendererModel.clientSpecMap.toJS?i.rendererModel.clientSpecMap.toJS():i.rendererModel.clientSpecMap;return!!i.rendererModel.wixCodeModel&&e.some(t,{type:"siteextension"})}function u(){function e(){return y}function u(e,i){if(n.isIFrameEvent(e,i)){if(s(i.data)&&A.setMessageTarget(function(i){e.contentWindow.postMessage(i,"*")}),d(i.data)&&!C.length&&"undefined"!=typeof window){var t=i.data.reportDef,r=i.data.params;t.errorCode?window.wixBiSession.sendError(t,r.p1,r.p2,r.p3,r.p4):window.wixBiSession.sendBI(t.endpoint,t.eventId,t.src,r)}C.forEach(function(e){e(i.data)})}}function l(){return h}function f(e,t,r){if(h)console.warn("Wix code is already initiated");else{var s,d=o.getAppsBaseInfo({clientSpecMap:t,serviceTopology:e.serviceTopology,rendererModel:e.rendererModel}).length>0;if(c(e)){var l=a.getAppSpec(t);s=i.buildUrl(e,l,r),y=n.getIFrameForApp(s,l)}else{if(!d)return;s=i.buildStaticUrl(e,r),y=n.getIFrameForApp(s,{})}var f=u.bind(null,y);window.addEventListener("message",f,!1),p(y),h=!0}}function g(e){C.push(e)}function m(e){P.push(e)}function w(e){return P.reduce(function(e,i){return i(e)},e)}function v(e){e&&A.sendOrHoldMessage(w(e))}function M(e,i){!D&&c(e)&&r.asyncGetPreLoadMessage(e,i,function(e){b&&!D&&(D=e,A.sendOrHoldMessage(D))})}function I(e,i){(!B&&c(e)||o.getAppsBaseInfo({clientSpecMap:e.rendererModel.clientSpecMap,serviceTopology:e.serviceTopology,rendererModel:e.rendererModel}))&&r.asyncGetPreLoadUserCodeMessage(e,i,function(e){B||(B=e,A.sendOrHoldMessage(B))})}function S(e,i){!U&&c(e)&&r.asyncGetPreInitMessage(e,i,function(e){U||(U=e,A.sendOrHoldMessage(U))})}function x(e){var i=C.indexOf(e);-1!==i&&C.splice(i,1)}var y,C=[],P=[],A=t.get(),h=!1,b=!0,D=null,B=null,U=null;return{init:f,sendMessage:v,registerMessageHandler:g,registerMessageModifier:m,unregisterMessageHandler:x,preLoadWidgets:M,preLoadUserCode:I,preInitWidgets:S,isAppInitiated:l,getAppsIframe:e}}return{getApi:u}}),define("wixCodeInit/api/initMainR",["lodash","wixCodeInit/utils/specMapUtils","wixCodeInit/utils/appsUtils"],function(e,i,t){function n(n,a,o,s,d,p,c){function u(e){return i.getAppSpec(e)||I.applications.length}function l(e){return new e.FullSiteData(o,function(){})}function f(i,t){if(!t)return!1;var n=e.find(i.pageList.pages,{pageId:t});return!!n&&!n.pageJsonFileName}function g(e){var i=l(e);i.currentUrl=e.urlUtils.parseUrl(p);var t=e.wixUrlParser.parseUrl(i,p);return t&&t.pageId}function m(e,i,t){i&&f(i,g(t))||(n.init(o,e,I),u(e)&&(n.preLoadUserCode(o,p),!!o.publicModel&&n.preLoadWidgets(o,p)))}p=p||window.document.location.href;var w=e.trimEnd(o.serviceTopology.scriptsLocationMap["js-wixcode-sdk"],"/")+"/lib/"+(d.getParameterByName("debug")?"wix.js":"wix.min.js"),v=r||e.trimEnd(o.serviceTopology.scriptsLocationMap["semi-native-sdk"],"/")+"/lib/"+(d.getParameterByName("debug")?"wix.js":"wix.min.js"),M="true"===d.getParameterByName("useWixCodeFallback")||!window.Worker||c,I={isMobileView:s,sdkSource:w,semiNativeSDKSource:v,runtimeSource:d.getParameterByName("WixCodeRuntimeSource"),ReactSource:d.getParameterByName("ReactSource"),useWixCodeFallback:M},S=d.getParameterByName("viewerPlatformAppSources");I.applications=t.getAppsBaseInfo({rendererModel:o.rendererModel,clientSpecMap:o.rendererModel.clientSpecMap,serviceTopology:o.serviceTopology,viewerPlatformAppSources:S,santaBase:o.santaBase}),function(){function i(e){m(o.rendererModel.clientSpecMap,o.publicModel,e)}e.isObject(a)?i(a):requirejs.defined("utils")?i(requirejs("utils")):requirejs(["utils"],i)}()}var r="http://static.parastorage.com/services/semi-native-sdk/1.4.0/lib/wix.min.js";return n}),define("wixCodeInit",["wixCodeInit/api/wixCodeAppApi","wixCodeInit/api/initMainR","wixCodeInit/utils/specMapUtils","wixCodeInit/utils/appsUtils","wixCodeInit/utils/widgetsPreLoader"],function(e,i,t,n,r){return{getAppApi:e.getApi,initMainR:i,specMapUtils:t,appsUtils:n,registerDeps:r.registerDeps}});
//# sourceMappingURL=wixCodeInit.min.js.map